<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section - 4 Data Prep | Cryptocurrency Research</title>
  <meta name="description" content="Section - 4 Data Prep | Cryptocurrency Research" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section - 4 Data Prep | Cryptocurrency Research" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section - 4 Data Prep | Cryptocurrency Research" />
  
  
  

<meta name="author" content="Riccardo (Ricky) Esclapon - LinkedIn, Personal Website" />
<meta name="author" content="John Chandler Johnson - LinkedIn" />
<meta name="author" content="Kai R. Larsen - LinkedIn, ResearchGate" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="explore-data.html"/>
<link rel="next" href="visualization.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<script async defer src="https://hypothes.is/embed.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1RJSX0YETF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1RJSX0YETF');
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121543940-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121543940-3');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html">Cryptocurrency Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-will-i-learn"><i class="fa fa-check"></i><b>1.1</b> What will I learn?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#before-getting-started"><i class="fa fa-check"></i><b>1.2</b> Before Getting Started</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#high-level-version"><i class="fa fa-check"></i><b>1.2.1</b> High-Level Version</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#format-notes"><i class="fa fa-check"></i><b>1.3</b> Format Notes</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#plan-of-attack"><i class="fa fa-check"></i><b>1.4</b> Plan of Attack</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#who-is-this-example-for"><i class="fa fa-check"></i><b>1.5</b> Who is this example for?</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#reproducibility"><i class="fa fa-check"></i><b>1.6</b> Reproducibility</a><ul>
<li class="chapter" data-level="1.6.1" data-path="introduction.html"><a href="introduction.html#the-cost-of-non-reproducible-research"><i class="fa fa-check"></i><b>1.6.1</b> The cost of non-reproducible research</a></li>
<li class="chapter" data-level="1.6.2" data-path="introduction.html"><a href="introduction.html#github"><i class="fa fa-check"></i><b>1.6.2</b> GitHub</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#disclaimer"><i class="fa fa-check"></i><b>1.7</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>2</b> Setup and Installation</a><ul>
<li class="chapter" data-level="2.1" data-path="setup.html"><a href="setup.html#run-in-the-cloud"><i class="fa fa-check"></i><b>2.1</b> Option 1 - Run in the Cloud</a></li>
<li class="chapter" data-level="2.2" data-path="setup.html"><a href="setup.html#option-2---run-locally"><i class="fa fa-check"></i><b>2.2</b> Option 2 - Run Locally</a><ul>
<li class="chapter" data-level="2.2.1" data-path="setup.html"><a href="setup.html#setup-r"><i class="fa fa-check"></i><b>2.2.1</b> Setup R</a></li>
<li class="chapter" data-level="2.2.2" data-path="setup.html"><a href="setup.html#installing-and-loading-packages"><i class="fa fa-check"></i><b>2.2.2</b> Install and Load Packages</a></li>
<li class="chapter" data-level="2.2.3" data-path="setup.html"><a href="setup.html#install-pacman"><i class="fa fa-check"></i><b>2.2.3</b> Install Pacman</a></li>
<li class="chapter" data-level="2.2.4" data-path="setup.html"><a href="setup.html#load-pacman"><i class="fa fa-check"></i><b>2.2.4</b> Load Pacman</a></li>
<li class="chapter" data-level="2.2.5" data-path="setup.html"><a href="setup.html#install-all-other-packages"><i class="fa fa-check"></i><b>2.2.5</b> Install All Other Packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="explore-data.html"><a href="explore-data.html"><i class="fa fa-check"></i><b>3</b> Explore the Data</a><ul>
<li class="chapter" data-level="3.1" data-path="explore-data.html"><a href="explore-data.html#pull-the-data"><i class="fa fa-check"></i><b>3.1</b> Pull the Data</a></li>
<li class="chapter" data-level="3.2" data-path="explore-data.html"><a href="explore-data.html#data-preview"><i class="fa fa-check"></i><b>3.2</b> Data Preview</a></li>
<li class="chapter" data-level="3.3" data-path="explore-data.html"><a href="explore-data.html#the-definition-of-a-price"><i class="fa fa-check"></i><b>3.3</b> The definition of a “price”</a><ul>
<li class="chapter" data-level="3.3.1" data-path="explore-data.html"><a href="explore-data.html#order-book"><i class="fa fa-check"></i><b>3.3.1</b> Order Book</a></li>
<li class="chapter" data-level="3.3.2" data-path="explore-data.html"><a href="explore-data.html#in-summary"><i class="fa fa-check"></i><b>3.3.2</b> In Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="explore-data.html"><a href="explore-data.html#data-quality"><i class="fa fa-check"></i><b>3.4</b> Data Quality</a></li>
<li class="chapter" data-level="3.5" data-path="explore-data.html"><a href="explore-data.html#data-source-additional-details"><i class="fa fa-check"></i><b>3.5</b> Data Source Additional Details</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>4</b> Data Prep</a><ul>
<li class="chapter" data-level="4.1" data-path="data-prep.html"><a href="data-prep.html#remove-nulls"><i class="fa fa-check"></i><b>4.1</b> Remove Nulls</a></li>
<li class="chapter" data-level="4.2" data-path="data-prep.html"><a href="data-prep.html#calculate-price_usd-column"><i class="fa fa-check"></i><b>4.2</b> Calculate <code>price_usd</code> Column</a></li>
<li class="chapter" data-level="4.3" data-path="data-prep.html"><a href="data-prep.html#clean-data-by-group"><i class="fa fa-check"></i><b>4.3</b> Clean Data by Group</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-prep.html"><a href="data-prep.html#remove-symbols-without-enough-rows"><i class="fa fa-check"></i><b>4.3.1</b> Remove symbols without enough rows</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-prep.html"><a href="data-prep.html#remove-symbols-without-data-from-the-last-3-days"><i class="fa fa-check"></i><b>4.3.2</b> Remove symbols without data from the last 3 days</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-prep.html"><a href="data-prep.html#calculate-target"><i class="fa fa-check"></i><b>4.4</b> Calculate Target</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-prep.html"><a href="data-prep.html#convert-to-tsibble"><i class="fa fa-check"></i><b>4.4.1</b> Convert to tsibble</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-prep.html"><a href="data-prep.html#fill-gaps"><i class="fa fa-check"></i><b>4.4.2</b> Fill gaps</a></li>
<li class="chapter" data-level="4.4.3" data-path="data-prep.html"><a href="data-prep.html#calculate-target-1"><i class="fa fa-check"></i><b>4.4.3</b> Calculate Target</a></li>
<li class="chapter" data-level="4.4.4" data-path="data-prep.html"><a href="data-prep.html#calculate-lagged-prices"><i class="fa fa-check"></i><b>4.4.4</b> Calculate Lagged Prices</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-prep.html"><a href="data-prep.html#remove-nulls-again"><i class="fa fa-check"></i><b>4.5</b> Remove Nulls</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization 📉</a><ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#basics---ggplot2"><i class="fa fa-check"></i><b>5.1</b> Basics - ggplot2</a></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#using-extensions"><i class="fa fa-check"></i><b>5.2</b> Using Extensions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="visualization.html"><a href="visualization.html#ggthemes"><i class="fa fa-check"></i><b>5.2.1</b> ggthemes</a></li>
<li class="chapter" data-level="5.2.2" data-path="visualization.html"><a href="visualization.html#plotly"><i class="fa fa-check"></i><b>5.2.2</b> plotly</a></li>
<li class="chapter" data-level="5.2.3" data-path="visualization.html"><a href="visualization.html#ggpubr"><i class="fa fa-check"></i><b>5.2.3</b> ggpubr</a></li>
<li class="chapter" data-level="5.2.4" data-path="visualization.html"><a href="visualization.html#ggforce"><i class="fa fa-check"></i><b>5.2.4</b> ggforce</a></li>
<li class="chapter" data-level="5.2.5" data-path="visualization.html"><a href="visualization.html#gganimate"><i class="fa fa-check"></i><b>5.2.5</b> gganimate</a></li>
<li class="chapter" data-level="5.2.6" data-path="visualization.html"><a href="visualization.html#ggtimeseries"><i class="fa fa-check"></i><b>5.2.6</b> ggTimeSeries</a></li>
<li class="chapter" data-level="5.2.7" data-path="visualization.html"><a href="visualization.html#rayshader"><i class="fa fa-check"></i><b>5.2.7</b> Rayshader</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-validation-plan.html"><a href="model-validation-plan.html"><i class="fa fa-check"></i><b>6</b> Model Validation Plan</a><ul>
<li class="chapter" data-level="6.1" data-path="model-validation-plan.html"><a href="model-validation-plan.html#testing-models"><i class="fa fa-check"></i><b>6.1</b> Testing Models</a></li>
<li class="chapter" data-level="6.2" data-path="model-validation-plan.html"><a href="model-validation-plan.html#cross-validation"><i class="fa fa-check"></i><b>6.2</b> Cross Validation</a><ul>
<li class="chapter" data-level="6.2.1" data-path="model-validation-plan.html"><a href="model-validation-plan.html#time-aware-cross-validation"><i class="fa fa-check"></i><b>6.2.1</b> Time Aware Cross Validation</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="model-validation-plan.html"><a href="model-validation-plan.html#fix-data-by-split"><i class="fa fa-check"></i><b>6.3</b> Fix Data by Split</a><ul>
<li class="chapter" data-level="6.3.1" data-path="model-validation-plan.html"><a href="model-validation-plan.html#zero-variance"><i class="fa fa-check"></i><b>6.3.1</b> Zero Variance</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="model-validation-plan.html"><a href="model-validation-plan.html#nest-data"><i class="fa fa-check"></i><b>6.4</b> Nest data</a><ul>
<li class="chapter" data-level="6.4.1" data-path="model-validation-plan.html"><a href="model-validation-plan.html#join-results"><i class="fa fa-check"></i><b>6.4.1</b> Join Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="predictive-modeling.html"><a href="predictive-modeling.html"><i class="fa fa-check"></i><b>7</b> Predictive Modeling</a><ul>
<li class="chapter" data-level="7.1" data-path="predictive-modeling.html"><a href="predictive-modeling.html#example-simple-model"><i class="fa fa-check"></i><b>7.1</b> Example Simple Model</a><ul>
<li class="chapter" data-level="7.1.1" data-path="predictive-modeling.html"><a href="predictive-modeling.html#using-functional-programming"><i class="fa fa-check"></i><b>7.1.1</b> Using Functional Programming</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="predictive-modeling.html"><a href="predictive-modeling.html#caret"><i class="fa fa-check"></i><b>7.2</b> Caret</a><ul>
<li class="chapter" data-level="7.2.1" data-path="predictive-modeling.html"><a href="predictive-modeling.html#parallel-processing"><i class="fa fa-check"></i><b>7.2.1</b> Parallel Processing</a></li>
<li class="chapter" data-level="7.2.2" data-path="predictive-modeling.html"><a href="predictive-modeling.html#more-functional-programming"><i class="fa fa-check"></i><b>7.2.2</b> More Functional Programming</a></li>
<li class="chapter" data-level="7.2.3" data-path="predictive-modeling.html"><a href="predictive-modeling.html#generalize-the-function"><i class="fa fa-check"></i><b>7.2.3</b> Generalize the Function</a></li>
<li class="chapter" data-level="7.2.4" data-path="predictive-modeling.html"><a href="predictive-modeling.html#xgboost-models"><i class="fa fa-check"></i><b>7.2.4</b> XGBoost Models</a></li>
<li class="chapter" data-level="7.2.5" data-path="predictive-modeling.html"><a href="predictive-modeling.html#neural-network-models"><i class="fa fa-check"></i><b>7.2.5</b> Neural Network Models</a></li>
<li class="chapter" data-level="7.2.6" data-path="predictive-modeling.html"><a href="predictive-modeling.html#random-forest-models"><i class="fa fa-check"></i><b>7.2.6</b> Random Forest Models</a></li>
<li class="chapter" data-level="7.2.7" data-path="predictive-modeling.html"><a href="predictive-modeling.html#principal-component-regression"><i class="fa fa-check"></i><b>7.2.7</b> Principal Component Regression</a></li>
<li class="chapter" data-level="7.2.8" data-path="predictive-modeling.html"><a href="predictive-modeling.html#caret-options"><i class="fa fa-check"></i><b>7.2.8</b> Caret Options</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="predictive-modeling.html"><a href="predictive-modeling.html#make-predictions"><i class="fa fa-check"></i><b>7.3</b> Make Predictions</a></li>
<li class="chapter" data-level="7.4" data-path="predictive-modeling.html"><a href="predictive-modeling.html#timeseries"><i class="fa fa-check"></i><b>7.4</b> Timeseries</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html"><i class="fa fa-check"></i><b>8</b> Evaluate Model Performance</a><ul>
<li class="chapter" data-level="8.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#summarizing-models"><i class="fa fa-check"></i><b>8.1</b> Summarizing models</a><ul>
<li class="chapter" data-level="8.1.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#mae"><i class="fa fa-check"></i><b>8.1.1</b> MAE</a></li>
<li class="chapter" data-level="8.1.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#rmse"><i class="fa fa-check"></i><b>8.1.2</b> RMSE</a></li>
<li class="chapter" data-level="8.1.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#r-squared"><i class="fa fa-check"></i><b>8.1.3</b> R Squared</a></li>
<li class="chapter" data-level="8.1.4" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#get-metrics"><i class="fa fa-check"></i><b>8.1.4</b> Get Metrics</a></li>
<li class="chapter" data-level="8.1.5" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#comparing-metrics"><i class="fa fa-check"></i><b>8.1.5</b> Comparing Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#data-prep---adjust-prices"><i class="fa fa-check"></i><b>8.2</b> Data Prep - Adjust Prices</a><ul>
<li class="chapter" data-level="8.2.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#add-last-price"><i class="fa fa-check"></i><b>8.2.1</b> Add Last Price</a></li>
<li class="chapter" data-level="8.2.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#convert-to-percentage-change"><i class="fa fa-check"></i><b>8.2.2</b> Convert to Percentage Change</a></li>
<li class="chapter" data-level="8.2.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#actuals"><i class="fa fa-check"></i><b>8.2.3</b> Actuals</a></li>
<li class="chapter" data-level="8.2.4" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#actuals-as-change"><i class="fa fa-check"></i><b>8.2.4</b> Actuals as % Change</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#review-summary-statistics"><i class="fa fa-check"></i><b>8.3</b> Review Summary Statistics</a><ul>
<li class="chapter" data-level="8.3.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#calculate-r2"><i class="fa fa-check"></i><b>8.3.1</b> Calculate R^2</a></li>
<li class="chapter" data-level="8.3.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#calculate-rmse-no-NA"><i class="fa fa-check"></i><b>8.3.2</b> Calculate RMSE</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#adjust-prices-all-models"><i class="fa fa-check"></i><b>8.4</b> Adjust Prices - All Models</a><ul>
<li class="chapter" data-level="8.4.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#add-last-price-1"><i class="fa fa-check"></i><b>8.4.1</b> Add Last Price</a></li>
<li class="chapter" data-level="8.4.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#convert-to-change"><i class="fa fa-check"></i><b>8.4.2</b> Convert to % Change</a></li>
<li class="chapter" data-level="8.4.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#add-metrics"><i class="fa fa-check"></i><b>8.4.3</b> Add Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#evaluate-metrics-across-splits"><i class="fa fa-check"></i><b>8.5</b> Evaluate Metrics Across Splits</a><ul>
<li class="chapter" data-level="8.5.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#evaluate-rmse-test"><i class="fa fa-check"></i><b>8.5.1</b> Evaluate RMSE Test</a></li>
<li class="chapter" data-level="8.5.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#holdout-3"><i class="fa fa-check"></i><b>8.5.2</b> Holdout</a></li>
<li class="chapter" data-level="8.5.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#union-results"><i class="fa fa-check"></i><b>8.5.3</b> Union Results</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#evaluate-r2"><i class="fa fa-check"></i><b>8.6</b> Evaluate R^2</a><ul>
<li class="chapter" data-level="8.6.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#test-1"><i class="fa fa-check"></i><b>8.6.1</b> Test</a></li>
<li class="chapter" data-level="8.6.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#holdout-4"><i class="fa fa-check"></i><b>8.6.2</b> Holdout</a></li>
<li class="chapter" data-level="8.6.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#union-results-1"><i class="fa fa-check"></i><b>8.6.3</b> Union Results</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#visualize-results"><i class="fa fa-check"></i><b>8.7</b> Visualize Results</a><ul>
<li class="chapter" data-level="8.7.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#rmse-visualization"><i class="fa fa-check"></i><b>8.7.1</b> RMSE Visualization</a></li>
<li class="chapter" data-level="8.7.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#both"><i class="fa fa-check"></i><b>8.7.2</b> Both</a></li>
<li class="chapter" data-level="8.7.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#results-by-the-cryptocurrency"><i class="fa fa-check"></i><b>8.7.3</b> Results by the Cryptocurrency</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#interactive-dashboard"><i class="fa fa-check"></i><b>8.8</b> Interactive Dashboard</a></li>
<li class="chapter" data-level="8.9" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#visualizations---historical-metrics"><i class="fa fa-check"></i><b>8.9</b> Visualizations - Historical Metrics</a><ul>
<li class="chapter" data-level="8.9.1" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#best-models"><i class="fa fa-check"></i><b>8.9.1</b> Best Models</a></li>
<li class="chapter" data-level="8.9.2" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#most-predictable-cryptocurrency"><i class="fa fa-check"></i><b>8.9.2</b> Most Predictable Cryptocurrency</a></li>
<li class="chapter" data-level="8.9.3" data-path="evaluate-model-performance.html"><a href="evaluate-model-performance.html#accuracy-over-time"><i class="fa fa-check"></i><b>8.9.3</b> Accuracy Over Time</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="considerations.html"><a href="considerations.html"><i class="fa fa-check"></i><b>9</b> Considerations</a><ul>
<li class="chapter" data-level="9.1" data-path="considerations.html"><a href="considerations.html#not-a-trading-tutorial"><i class="fa fa-check"></i><b>9.1</b> Not a trading tutorial</a></li>
<li class="chapter" data-level="9.2" data-path="considerations.html"><a href="considerations.html#session-information"><i class="fa fa-check"></i><b>9.2</b> Session Information</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="archive.html"><a href="archive.html"><i class="fa fa-check"></i><b>10</b> Archive</a><ul>
<li class="chapter" data-level="10.1" data-path="archive.html"><a href="archive.html#november-2020"><i class="fa fa-check"></i><b>10.1</b> November 2020</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>11</b> References</a><ul>
<li class="chapter" data-level="11.1" data-path="references.html"><a href="references.html#document-format"><i class="fa fa-check"></i><b>11.1</b> Document Format</a></li>
<li class="chapter" data-level="11.2" data-path="references.html"><a href="references.html#open-review-toolkit-ref"><i class="fa fa-check"></i><b>11.2</b> Open Review Toolkit</a></li>
<li class="chapter" data-level="11.3" data-path="references.html"><a href="references.html#visualization-1"><i class="fa fa-check"></i><b>11.3</b> Visualization</a></li>
<li class="chapter" data-level="11.4" data-path="references.html"><a href="references.html#predictive-modeling-1"><i class="fa fa-check"></i><b>11.4</b> Predictive Modeling</a><ul>
<li class="chapter" data-level="11.4.1" data-path="references.html"><a href="references.html#time-series"><i class="fa fa-check"></i><b>11.4.1</b> Time Series</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="references.html"><a href="references.html#evaluate-model-performance-1"><i class="fa fa-check"></i><b>11.5</b> Evaluate Model Performance</a></li>
<li class="chapter" data-level="11.6" data-path="references.html"><a href="references.html#additional-contributors"><i class="fa fa-check"></i><b>11.6</b> Additional Contributors</a></li>
<li class="chapter" data-level="11.7" data-path="references.html"><a href="references.html#r-packages-used"><i class="fa fa-check"></i><b>11.7</b> R Packages Used</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="blank"><img src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" width="80"></a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cryptocurrency Research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-prep" class="section level1">
<h1><span class="header-section-number">Section - 4</span> Data Prep</h1>
<p>Next we will do some data cleaning to make sure our data is in the format we need it to be in. For a gentler introduction to data prep using the <span style="color: #ae7b11;"><strong>dplyr</strong></span> package <span class="citation">(Wickham, François, et al. <a href="#ref-R-dplyr" role="doc-biblioref">2020</a>)</span> <a href="https://cryptocurrencyresearch.org/high-level/#/data-prep">consult the high-level version</a>.</p>
<div id="remove-nulls" class="section level2">
<h2><span class="header-section-number">4.1</span> Remove Nulls</h2>
<p>First off, we aren’t able to do anything at all with a row of data if we don’t know <strong><em>when</em></strong> the data was collected. The specific price doesn’t matter if we can’t tie it to a timestamp, given by the <span style="color: blue;"><strong>date_time_utc</strong></span> field.</p>
<p>We can exclude all rows where the <span style="color: blue;"><strong>date_time_utc</strong></span> field has a Null (missing) value by using the <span style="color: green;"><strong>filter()</strong></span> function from the <span style="color: #ae7b11;"><strong>dplyr</strong></span> package:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-prep.html#cb9-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">filter</span>(cryptodata, <span class="op">!</span><span class="kw">is.na</span>(date_time_utc))</span></code></pre></div>
<p>This step removed 0 rows from the data on the latest run (2021-04-30). The <span style="color: green;"><strong>is.na()</strong></span> function finds all cases where the <span style="color: blue;"><strong>date_time_utc</strong></span> field has a Null value. The function is preceded by the <span style="color: blue;"><strong>!</strong></span> operator, which tells the <span style="color: green;"><strong>filter()</strong></span> function to exclude these rows from the data.</p>
<p>By the same logic, if we don’t know what the price was for any of the rows, the whole row of data is useless and should be removed. But how will we define the price of a cryptocurrency?</p>
</div>
<div id="calculate-price_usd-column" class="section level2">
<h2><span class="header-section-number">4.2</span> Calculate <code>price_usd</code> Column</h2>
<p>In the <a href="explore-data.html#the-definition-of-a-price">previous section we discussed the intricacies of a cryptocurrency’s price</a>. We could complicate our definition of a price by considering both the <span style="color: blue;"><strong>bid</strong></span> and <span style="color: blue;"><strong>ask</strong></span> prices from the perspective of someone who wants to perform trades, but <a href="considerations.html#considerations"><strong>this is not a trading tutorial</strong></a>. Instead, we will define the price of a cryptocurrency as the price we could purchase it for. We will calculate the <span style="color: blue;"><strong>price_usd</strong></span> field using the cheapest price available from the <span style="color: blue;"><strong>ask</strong></span> side where at least $15 worth of the cryptocurrency are being sold.</p>
<p>Therefore, let’s figure out the lowest price from the order book data that would allow us to purchase at least $15 worth of the cryptocurrency. To do this, for each <span style="color: blue;"><strong>ask</strong></span> price and quantity, let’s figure out the value of the trade in US Dollars. We can create each of the new <span style="color: blue;"><strong>trade_usd</strong></span> columns using the <span style="color: green;"><strong>mutate()</strong></span> function. The <span style="color: blue;"><strong>trade_usd_1</strong></span> should be calculated as the <span style="color: blue;"><strong>ask_1_price</strong></span> multiplied by the <span style="color: blue;"><strong>ask_1_quantity</strong></span>. The next one <span style="color: blue;"><strong>trade_usd_2</strong></span> should consider the <span style="color: blue;"><strong>ask_2_price</strong></span>, but be multiplied by the sum of <span style="color: blue;"><strong>ask_1_quantity</strong></span> and <span style="color: blue;"><strong>ask_2_quantity</strong></span> because at the <span style="color: blue;"><strong>ask_2_price</strong></span> pricepoint we can also purchase the quantity available at the <span style="color: blue;"><strong>ask_1_price</strong></span> pricepoint:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-prep.html#cb10-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">mutate</span>(cryptodata, </span>
<span id="cb10-2"><a href="data-prep.html#cb10-2"></a>                     <span class="dt">trade_usd_1 =</span> ask_<span class="dv">1</span>_price <span class="op">*</span><span class="st"> </span>ask_<span class="dv">1</span>_quantity,</span>
<span id="cb10-3"><a href="data-prep.html#cb10-3"></a>                     <span class="dt">trade_usd_2 =</span> ask_<span class="dv">2</span>_price <span class="op">*</span><span class="st"> </span>(ask_<span class="dv">1</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">2</span>_quantity),</span>
<span id="cb10-4"><a href="data-prep.html#cb10-4"></a>                     <span class="dt">trade_usd_3 =</span> ask_<span class="dv">3</span>_price <span class="op">*</span><span class="st"> </span>(ask_<span class="dv">1</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">2</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">3</span>_quantity),</span>
<span id="cb10-5"><a href="data-prep.html#cb10-5"></a>                     <span class="dt">trade_usd_4 =</span> ask_<span class="dv">4</span>_price <span class="op">*</span><span class="st"> </span>(ask_<span class="dv">1</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">2</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">3</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">4</span>_quantity),</span>
<span id="cb10-6"><a href="data-prep.html#cb10-6"></a>                     <span class="dt">trade_usd_5 =</span> ask_<span class="dv">5</span>_price <span class="op">*</span><span class="st"> </span>(ask_<span class="dv">1</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">2</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">3</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">4</span>_quantity <span class="op">+</span><span class="st"> </span>ask_<span class="dv">5</span>_quantity))</span></code></pre></div>
<!-- *For a more in-depth explanation of how [**mutate()**]{style="color: green;"} works, [see the high-level version of the tutorial](https://cryptocurrencyresearch.org/high-level/#/mutate-function---dplyr)* -->
<p>We can confirm that the <span style="color: blue;"><strong>trade_usd_1</strong></span> field is calculating the $ value of the lowest ask price and quantity:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-prep.html#cb11-1"></a><span class="kw">head</span>(<span class="kw">select</span>(cryptodata, symbol, date_time_utc, ask_<span class="dv">1</span>_price, ask_<span class="dv">1</span>_quantity, trade_usd_<span class="dv">1</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   symbol date_time_utc       ask_1_price ask_1_quantity trade_usd_1
##   &lt;chr&gt;  &lt;dttm&gt;                    &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
## 1 BTC    2021-04-30 00:00:00    53560.            0.497      26626.
## 2 ETH    2021-04-30 00:00:01     2759.            0.179        495.
## 3 EOS    2021-04-30 00:00:01        5.90         90.7          535.
## 4 LTC    2021-04-30 00:00:02      255.            8.03        2050.
## 5 BSV    2021-04-30 00:00:04      282.            8.4         2367.
## 6 ADA    2021-04-30 00:00:04        1.31        470            614.</code></pre>
<p>Now we can use the <span style="color: green;"><strong>mutate()</strong></span> function to create the new field <span style="color: blue;"><strong>price_usd</strong></span> and find the lowest price at which we could have purchased at least $15 worth of the cryptocurrency. We can use the <span style="color: green;"><strong>case_when()</strong></span> function to find the first <span style="color: blue;"><strong>trade_usd</strong></span> value that is greater or equal to $15, and assign the correct <span style="color: blue;"><strong>ask_price</strong></span> for the new column <span style="color: blue;"><strong>price_usd</strong></span>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-prep.html#cb13-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">mutate</span>(cryptodata, </span>
<span id="cb13-2"><a href="data-prep.html#cb13-2"></a>                     <span class="dt">price_usd =</span> <span class="kw">case_when</span>(</span>
<span id="cb13-3"><a href="data-prep.html#cb13-3"></a>                       cryptodata<span class="op">$</span>trade_usd_<span class="dv">1</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">~</span><span class="st"> </span>cryptodata<span class="op">$</span>ask_<span class="dv">1</span>_price,</span>
<span id="cb13-4"><a href="data-prep.html#cb13-4"></a>                       cryptodata<span class="op">$</span>trade_usd_<span class="dv">2</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">~</span><span class="st"> </span>cryptodata<span class="op">$</span>ask_<span class="dv">2</span>_price,</span>
<span id="cb13-5"><a href="data-prep.html#cb13-5"></a>                       cryptodata<span class="op">$</span>trade_usd_<span class="dv">3</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">~</span><span class="st"> </span>cryptodata<span class="op">$</span>ask_<span class="dv">3</span>_price,</span>
<span id="cb13-6"><a href="data-prep.html#cb13-6"></a>                       cryptodata<span class="op">$</span>trade_usd_<span class="dv">4</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">~</span><span class="st"> </span>cryptodata<span class="op">$</span>ask_<span class="dv">4</span>_price,</span>
<span id="cb13-7"><a href="data-prep.html#cb13-7"></a>                       cryptodata<span class="op">$</span>trade_usd_<span class="dv">5</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">15</span> <span class="op">~</span><span class="st"> </span>cryptodata<span class="op">$</span>ask_<span class="dv">5</span>_price))</span></code></pre></div>
<p>Let’s also remove any rows that have Null values for the new <span style="color: blue;"><strong>price_usd</strong></span> field <a href="data-prep.html#remove-nulls">like we did for the <span style="color: blue;"><strong>date_time_utc</strong></span> field in a previous step</a>. These will mostly be made up of rows where the value of trades through the 5th lowest ask price was lower than $15.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-prep.html#cb14-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">filter</span>(cryptodata, <span class="op">!</span><span class="kw">is.na</span>(price_usd))</span></code></pre></div>
<p>This step removed 13145 rows on the latest run.</p>
</div>
<div id="clean-data-by-group" class="section level2">
<h2><span class="header-section-number">4.3</span> Clean Data by Group</h2>
<p>In the <a href="https://cryptocurrencyresearch.org/high-level/">high-level version of this tutorial</a> we only dealt with one cryptocurrency. In this version however, we will be creating independent models for each cryptocurrency. Because of this, <strong>we need to ensure data quality not only for the data as a whole, but also for the data associated with each individual cryptocurrency</strong>. Instead of considering all rows when applying a transformation, we can <span style="color: purple;"><strong>group</strong></span> the data by the individual cryptocurrency and apply the transformation to each group. This will only work with compatible functions from <span style="color: #ae7b11;"><strong>dplyr</strong></span> and the <span style="color: #ae7b11;"><strong>tidyverse</strong></span>.</p>
<p>For example, we could count the number of observations by running the <span style="color: green;"><strong>count()</strong></span> function on the data:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-prep.html#cb15-1"></a><span class="kw">count</span>(cryptodata)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##        n
##    &lt;int&gt;
## 1 286855</code></pre>
<p>But what if we wanted to know how many observations in the data are associated with each cryptocurrency separately?</p>
<p>We can group the data using the <span style="color: green;"><strong>group_by()</strong></span> function from the <span style="color: #ae7b11;"><strong>dplyr</strong></span> package and group the data by the cryptocurrency <span style="color: blue;"><strong>symbol</strong></span>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-prep.html#cb17-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">group_by</span>(cryptodata, symbol)</span></code></pre></div>
<p>Now if we run the same operation using the <span style="color: green;"><strong>count()</strong></span> function, the operation is performed grouped by the cryptocurrency symbol:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-prep.html#cb18-1"></a><span class="kw">count</span>(cryptodata)</span></code></pre></div>
<pre><code>## # A tibble: 223 x 2
## # Groups:   symbol [223]
##    symbol     n
##    &lt;chr&gt;  &lt;int&gt;
##  1 1INCH    692
##  2 AAB      110
##  3 AAVE     692
##  4 ACAT     671
##  5 ACT     1924
##  6 ADA     2263
##  7 ADXN    1380
##  8 AKRO     405
##  9 ALPHA    376
## 10 AMB     1552
## # ... with 213 more rows</code></pre>
<p>We can remove the grouping at any point by running the <span style="color: green;"><strong>ungroup()</strong></span> function:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-prep.html#cb20-1"></a><span class="kw">count</span>(<span class="kw">ungroup</span>(cryptodata))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##        n
##    &lt;int&gt;
## 1 286855</code></pre>
<div id="remove-symbols-without-enough-rows" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Remove symbols without enough rows</h3>
<p>Because this dataset evolves over time, we will need to be proactive about issues that may arise even if they aren’t currently a problem.</p>
<p>What happens if a new cryptocurrency gets added to the cryptocurrency exchange? If we only had a couple days of data for an asset, not only would that not be enough information to build effective predictive models, but we may run into actual errors since the data will be further split into more groups to validate the results of the models against several datasets using <span style="color: purple;"><strong>cross validation</strong></span>, more to come on that later.</p>
<p>To ensure we have a reasonable amount of data for each individual cryptocurrency, let’s filter out any cryptocurrencies that don’t have at least 1,000 observations using the <span style="color: green;"><strong>filter()</strong></span> function:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-prep.html#cb22-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">filter</span>(cryptodata, <span class="kw">n</span>() <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1000</span>)</span></code></pre></div>
<p>The number of rows for the <code>cryptodata</code> dataset before the filtering step was 286855 and is now 242765. This step removed 87 cryptocurrencies from the analysis that did not have enough observations associated with them.</p>
</div>
<div id="remove-symbols-without-data-from-the-last-3-days" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Remove symbols without data from the last 3 days</h3>
<p>If there was no data collected for a cryptocurrency over the last 3 day period, let’s exclude that asset from the dataset since we are only looking to model data that is currently flowing through the process. If an asset is removed from the exchange (if a project is a scam for example) or is no longer being actively captured by the data collection process, we can’t make new predictions for it, so might as well exclude these ahead of time as well.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-prep.html#cb23-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">filter</span>(cryptodata, <span class="kw">max</span>(date) <span class="op">&gt;</span><span class="st"> </span><span class="kw">Sys.Date</span>()<span class="op">-</span><span class="dv">3</span>)</span></code></pre></div>
<p>The number of rows for the <code>cryptodata</code> dataset before this filtering step was 237703 and is now 242765.</p>
</div>
</div>
<div id="calculate-target" class="section level2">
<h2><span class="header-section-number">4.4</span> Calculate Target</h2>
<p>Our goal is to be able to make predictions on the price of each cryptocurrency 24 hours into the future from when the data was collected. Therefore, the <span style="color: purple;"><strong>target variable</strong></span> that we will be using as <em>what we want to predict</em> for the predictive models, is the price 24 hours into the future relative to when the data was collected.</p>
<p>To do this we can create a new column in the data that is the <span style="color: blue;"><strong>price_usd</strong></span> offset by 24 rows (one for each hour), but before we can do that we need to make sure there are no gaps anywhere in the data.</p>
<div id="convert-to-tsibble" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Convert to tsibble</h3>
<p>We can fill any gaps in the data using the <span style="color: #ae7b11;"><strong>tsibble</strong></span> package <span class="citation">(Wang et al. <a href="#ref-R-tsibble" role="doc-biblioref">2020</a>)</span>, which was covered in more detail in the <a href="https://cryptocurrencyresearch.org/high-level/#/timeseries-data-prep">high-level version of the tutorial</a>.</p>
<div id="convert-to-hourly-data" class="section level4">
<h4><span class="header-section-number">4.4.1.1</span> Convert to hourly data</h4>
<p>The data we are using was collected between the 0th and the 5th minute of every hour; it is collected in the same order every hour to try and get the timing as consistent as possible for each cryptocurrency, but the cadence is not exactly one hour. Therefore, if we convert the data now to a <span style="color: blue;"><strong>tsibble</strong></span> object, it would recognize the data as being collected on the wrong cadence.</p>
<p>To fix this issue, let’s create a new column called <span style="color: blue;"><strong>ts_index</strong></span> using the <span style="color: green;"><strong>mutate()</strong></span> function which will keep the information relating to the date and hour collected, but generalize the minutes and seconds as “00:00”, which will be correctly recognized by the <span style="color: #ae7b11;"><strong>tsibble</strong></span> package as being data collected on an hourly basis. The <span style="color: blue;"><strong>pkDummy</strong></span> field contains the date and hour, so we can add the text “:00:00” to the end of that field, and then convert the new string to a date time object using the <span style="color: green;"><strong>anytime()</strong></span> function from the <span style="color: #ae7b11;"><strong>anytime</strong></span> package <span class="citation">(Eddelbuettel <a href="#ref-R-anytime" role="doc-biblioref">2020</a>)</span>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-prep.html#cb24-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">mutate</span>(cryptodata, <span class="dt">ts_index =</span> <span class="kw">anytime</span>(<span class="kw">paste0</span>(pkDummy,<span class="st">&#39;:00:00&#39;</span>)))</span></code></pre></div>
<p>Before we can convert the data to be a <span style="color: blue;"><strong>tsibble</strong></span> and easily fill in the gaps, we also need to make sure there are no duplicate values in the <span style="color: blue;"><strong>ts_index</strong></span> column for each cryptocurrency. There shouldn’t be any duplicates, but just in case any make their way into the data somehow, we can use the <span style="color: green;"><strong>distinct()</strong></span> function from the <span style="color: #ae7b11;"><strong>dplyr</strong></span> package to prevent the issue from potentially arising:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-prep.html#cb25-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">distinct</span>(cryptodata, symbol, ts_index, <span class="dt">.keep_all=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>Now we can finally convert the table to a <span style="color: blue;"><strong>tsibble</strong></span> data type by using the <span style="color: green;"><strong>as_tsibble()</strong></span> function from the <span style="color: #ae7b11;"><strong>tsibble</strong></span> package <span class="citation">(Wang et al. <a href="#ref-R-tsibble" role="doc-biblioref">2020</a>)</span>, and providing the <span style="color: blue;"><strong>symbol</strong></span> column for the <span style="color: blue;"><strong>key</strong></span> parameter to preserve the grouped structure:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-prep.html#cb26-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">as_tsibble</span>(cryptodata, <span class="dt">index =</span> ts_index, <span class="dt">key =</span> symbol)</span></code></pre></div>
<p>Notice how the preview of the data below looks a bit different from the summary we were seeing up to this point, and now it says “A tsibble”, and next to the table dimensions says <strong>[1h]</strong>, indicating the observations are 1 hour apart from each other. The second row tells us the “Key” of the <span style="color: blue;"><strong>tsibble</strong></span> is the <span style="color: blue;"><strong>symbol</strong></span> column</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-prep.html#cb27-1"></a>cryptodata</span></code></pre></div>
<pre><code>## # A tsibble: 237,703 x 34 [1h] &lt;UTC&gt;
## # Key:       symbol [131]
## # Groups:    symbol [131]
##    pair  symbol quote_currency ask_1_price ask_1_quantity ask_2_price
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
##  1 ACTU~ ACT    USD                0.00709           2820     0.00709
##  2 ACTU~ ACT    USD                0.00709           2680     0.00709
##  3 ACTU~ ACT    USD                0.00709          52500     0.00786
##  4 ACTU~ ACT    USD                0.00709          52500     0.00786
##  5 ACTU~ ACT    USD                0.00709           7020     0.00709
##  6 ACTU~ ACT    USD                0.00709          52500     0.00786
##  7 ACTU~ ACT    USD                0.00709          52500     0.00786
##  8 ACTU~ ACT    USD                0.00709          52500     0.00786
##  9 ACTU~ ACT    USD                0.00709           7020     0.00709
## 10 ACTU~ ACT    USD                0.00709           7020     0.00709
## # ... with 237,693 more rows, and 28 more variables: ask_2_quantity &lt;dbl&gt;,
## #   ask_3_price &lt;dbl&gt;, ask_3_quantity &lt;dbl&gt;, ask_4_price &lt;dbl&gt;,
## #   ask_4_quantity &lt;dbl&gt;, ask_5_price &lt;dbl&gt;, ask_5_quantity &lt;dbl&gt;,
## #   bid_1_price &lt;dbl&gt;, bid_1_quantity &lt;dbl&gt;, bid_2_price &lt;dbl&gt;,
## #   bid_2_quantity &lt;dbl&gt;, bid_3_price &lt;dbl&gt;, bid_3_quantity &lt;dbl&gt;,
## #   bid_4_price &lt;dbl&gt;, bid_4_quantity &lt;dbl&gt;, bid_5_price &lt;dbl&gt;,
## #   bid_5_quantity &lt;dbl&gt;, date_time_utc &lt;dttm&gt;, date &lt;date&gt;, pkDummy &lt;chr&gt;,
## #   pkey &lt;chr&gt;, trade_usd_1 &lt;dbl&gt;, trade_usd_2 &lt;dbl&gt;, trade_usd_3 &lt;dbl&gt;,
## #   trade_usd_4 &lt;dbl&gt;, trade_usd_5 &lt;dbl&gt;, price_usd &lt;dbl&gt;, ts_index &lt;dttm&gt;</code></pre>
<!-- ### Scan gaps -->
<!-- Now we can use the [**scan_gaps()**]{style="color: green;"} function to return   -->
<!-- ```{r} -->
<!-- scan_gaps(cryptodata) -->
<!-- ``` -->
</div>
</div>
<div id="fill-gaps" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Fill gaps</h3>
<p>Now we can use the <span style="color: green;"><strong>fill_gaps()</strong></span> function from the <span style="color: #ae7b11;"><strong>tsibble</strong></span> package to fill any gaps found in the data, as being implicitly Null. Meaning, we will add these rows into the data with NA values for everything except for the date time field. This will allow us to safely compute the target price found 24 hours into the future relative to when each row was collected.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-prep.html#cb29-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">fill_gaps</span>(cryptodata)</span></code></pre></div>
<p>Now looking at the data again, there are 25629 additional rows that were added as implicitly missing in the data:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-prep.html#cb30-1"></a>cryptodata</span></code></pre></div>
<pre><code>## # A tsibble: 263,332 x 34 [1h] &lt;UTC&gt;
## # Key:       symbol [131]
## # Groups:    symbol [131]
##    pair  symbol quote_currency ask_1_price ask_1_quantity ask_2_price
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;                &lt;dbl&gt;          &lt;dbl&gt;       &lt;dbl&gt;
##  1 ACTU~ ACT    USD                0.00709           2820     0.00709
##  2 ACTU~ ACT    USD                0.00709           2680     0.00709
##  3 ACTU~ ACT    USD                0.00709          52500     0.00786
##  4 ACTU~ ACT    USD                0.00709          52500     0.00786
##  5 ACTU~ ACT    USD                0.00709           7020     0.00709
##  6 ACTU~ ACT    USD                0.00709          52500     0.00786
##  7 ACTU~ ACT    USD                0.00709          52500     0.00786
##  8 ACTU~ ACT    USD                0.00709          52500     0.00786
##  9 ACTU~ ACT    USD                0.00709           7020     0.00709
## 10 ACTU~ ACT    USD                0.00709           7020     0.00709
## # ... with 263,322 more rows, and 28 more variables: ask_2_quantity &lt;dbl&gt;,
## #   ask_3_price &lt;dbl&gt;, ask_3_quantity &lt;dbl&gt;, ask_4_price &lt;dbl&gt;,
## #   ask_4_quantity &lt;dbl&gt;, ask_5_price &lt;dbl&gt;, ask_5_quantity &lt;dbl&gt;,
## #   bid_1_price &lt;dbl&gt;, bid_1_quantity &lt;dbl&gt;, bid_2_price &lt;dbl&gt;,
## #   bid_2_quantity &lt;dbl&gt;, bid_3_price &lt;dbl&gt;, bid_3_quantity &lt;dbl&gt;,
## #   bid_4_price &lt;dbl&gt;, bid_4_quantity &lt;dbl&gt;, bid_5_price &lt;dbl&gt;,
## #   bid_5_quantity &lt;dbl&gt;, date_time_utc &lt;dttm&gt;, date &lt;date&gt;, pkDummy &lt;chr&gt;,
## #   pkey &lt;chr&gt;, trade_usd_1 &lt;dbl&gt;, trade_usd_2 &lt;dbl&gt;, trade_usd_3 &lt;dbl&gt;,
## #   trade_usd_4 &lt;dbl&gt;, trade_usd_5 &lt;dbl&gt;, price_usd &lt;dbl&gt;, ts_index &lt;dttm&gt;</code></pre>
<p>Now that all of the gaps have been filled in, let’s convert the data back to be in the structure of a <a href="https://tibble.tidyverse.org/"><span style="color: #ae7b11;"><strong>tibble</strong></span></a>, which is the data structure that supports the <a href="data-prep.html#clean-data-by-group">grouping structure we discussed previously</a>, and let’s group the data by the <span style="color: blue;"><strong>symbol</strong></span> again:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-prep.html#cb32-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">group_by</span>(<span class="kw">as_tibble</span>(cryptodata), symbol)</span></code></pre></div>
</div>
<div id="calculate-target-1" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Calculate Target</h3>
<p>Now we finally have everything we need to calculate the <strong>target variable</strong> containing the price 24 hours into the future relative to when the data was collected. We can use the usual <span style="color: green;"><strong>mutate()</strong></span> function to add a new column to the data called <span style="color: blue;"><strong>target_price_24h</strong></span>, and use the <span style="color: green;"><strong>lead()</strong></span> function from <span style="color: #ae7b11;"><strong>dplyr</strong></span> to offset the <span style="color: blue;"><strong>price_usd</strong></span> column by 24 hours:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-prep.html#cb33-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">mutate</span>(cryptodata, </span>
<span id="cb33-2"><a href="data-prep.html#cb33-2"></a>                     <span class="dt">target_price_24h =</span> <span class="kw">lead</span>(price_usd, <span class="dv">24</span>, <span class="dt">order_by=</span>ts_index))</span></code></pre></div>
</div>
<div id="calculate-lagged-prices" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Calculate Lagged Prices</h3>
<p>What about doing the opposite? If we added a new column showing the price from 24 hours earlier, could the price movement between then and when the data was collected help us predict where the price is headed next? If the price has gone down significantly over the previous 24 hours, is the price for the next 24 hours more likely to increase or decrease? What if the price has gone down significantly over the previous 24 hours, but has increased significantly since the past hour?</p>
<p>These relationships around the sensitivity of a price to recent price changes may help our models come up with more accurate forecasts about the future, so let’s go ahead and add some lagged prices using the same methodology used to calculate the target variable, but this time using the <span style="color: green;"><strong>lag()</strong></span> function to get past observations instead of the <span style="color: green;"><strong>lead()</strong></span> function used before:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-prep.html#cb34-1"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">mutate</span>(cryptodata,</span>
<span id="cb34-2"><a href="data-prep.html#cb34-2"></a>                     <span class="dt">lagged_price_1h  =</span> <span class="kw">lag</span>(price_usd, <span class="dv">1</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-3"><a href="data-prep.html#cb34-3"></a>                     <span class="dt">lagged_price_2h  =</span> <span class="kw">lag</span>(price_usd, <span class="dv">2</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-4"><a href="data-prep.html#cb34-4"></a>                     <span class="dt">lagged_price_3h  =</span> <span class="kw">lag</span>(price_usd, <span class="dv">3</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-5"><a href="data-prep.html#cb34-5"></a>                     <span class="dt">lagged_price_6h  =</span> <span class="kw">lag</span>(price_usd, <span class="dv">6</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-6"><a href="data-prep.html#cb34-6"></a>                     <span class="dt">lagged_price_12h =</span> <span class="kw">lag</span>(price_usd, <span class="dv">12</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-7"><a href="data-prep.html#cb34-7"></a>                     <span class="dt">lagged_price_24h =</span> <span class="kw">lag</span>(price_usd, <span class="dv">24</span>, <span class="dt">order_by=</span>ts_index),</span>
<span id="cb34-8"><a href="data-prep.html#cb34-8"></a>                     <span class="dt">lagged_price_3d  =</span> <span class="kw">lag</span>(price_usd, <span class="dv">24</span><span class="op">*</span><span class="dv">3</span>, <span class="dt">order_by=</span>ts_index))</span></code></pre></div>
<p><em>This step can be thought of as <span style="color: purple;"><strong>data engineering</strong></span> more than data cleaning, because rather than fixing an issue we are enhancing the dataset with columns that may help with the forecasts.</em></p>
<p>Let’s view an example of the oldest 30 rows of data associated with the Bitcoin cryptocurrency (<code>symbol == "BTC"</code>). With the oldest data starting from the top, the <span style="color: blue;"><strong>lagged_price_1h</strong></span> field should have a NA value for the first row because we don’t have any prices before that point. By that same logic, the <span style="color: blue;"><strong>lagged_price_24h</strong></span> column should be missing the first 24 values and have the last 6 values showing the first 6 rows of the <span style="color: blue;"><strong>price_usd</strong></span> column. The <span style="color: blue;"><strong>target_price_24h</strong></span> would values for the oldest data because the opposite is true and we don’t know the values for data for the most recent 24 rows of the data:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-prep.html#cb35-1"></a><span class="kw">print</span>(<span class="kw">select</span>(<span class="kw">filter</span>(cryptodata, symbol <span class="op">==</span><span class="st"> &#39;BTC&#39;</span>), </span>
<span id="cb35-2"><a href="data-prep.html#cb35-2"></a>             ts_index, price_usd, lagged_price_1h, </span>
<span id="cb35-3"><a href="data-prep.html#cb35-3"></a>             lagged_price_24h, target_price_24h), <span class="dt">n=</span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2,271 x 6
## # Groups:   symbol [1]
##    symbol ts_index            price_usd lagged_price_1h lagged_price_24h
##    &lt;chr&gt;  &lt;dttm&gt;                  &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
##  1 BTC    2021-01-26 00:00:00    32263.             NA               NA 
##  2 BTC    2021-01-26 01:00:00    32478.          32263.              NA 
##  3 BTC    2021-01-26 02:00:00    32757.          32478.              NA 
##  4 BTC    2021-01-26 03:00:00    32313.          32757.              NA 
##  5 BTC    2021-01-26 04:00:00    31516.          32313.              NA 
##  6 BTC    2021-01-26 05:00:00    32003.          31516.              NA 
##  7 BTC    2021-01-26 06:00:00    32068.          32003.              NA 
##  8 BTC    2021-01-26 07:00:00    31606.          32068.              NA 
##  9 BTC    2021-01-26 08:00:00    31644.          31606.              NA 
## 10 BTC    2021-01-26 09:00:00    31891.          31644.              NA 
## 11 BTC    2021-01-26 10:00:00    31811.          31891.              NA 
## 12 BTC    2021-01-26 11:00:00    32255.          31811.              NA 
## 13 BTC    2021-01-26 12:00:00    31799.          32255.              NA 
## 14 BTC    2021-01-26 13:00:00    31316.          31799.              NA 
## 15 BTC    2021-01-26 14:00:00    31734.          31316.              NA 
## 16 BTC    2021-01-26 15:00:00    31256.          31734.              NA 
## 17 BTC    2021-01-26 16:00:00    31751.          31256.              NA 
## 18 BTC    2021-01-26 17:00:00    31981.          31751.              NA 
## 19 BTC    2021-01-26 18:00:00    32196.          31981.              NA 
## 20 BTC    2021-01-26 19:00:00       NA           32196.              NA 
## 21 BTC    2021-01-26 20:00:00       NA              NA               NA 
## 22 BTC    2021-01-26 21:00:00       NA              NA               NA 
## 23 BTC    2021-01-26 22:00:00       NA              NA               NA 
## 24 BTC    2021-01-26 23:00:00       NA              NA               NA 
## 25 BTC    2021-01-27 00:00:00    32471.             NA            32263.
## 26 BTC    2021-01-27 01:00:00    32351.          32471.           32478.
## 27 BTC    2021-01-27 02:00:00    32102.          32351.           32757.
## 28 BTC    2021-01-27 03:00:00    31813.          32102.           32313.
## 29 BTC    2021-01-27 04:00:00    31799.          31813.           31516.
## 30 BTC    2021-01-27 05:00:00    31865.          31799.           32003.
## # ... with 2,241 more rows, and 1 more variable: target_price_24h &lt;dbl&gt;</code></pre>
<p>We can wrap the code used above in the <span style="color: green;"><strong>tail()</strong></span> function to show the most recent data and see the opposite dynamic with the new fields we created:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-prep.html#cb37-1"></a><span class="kw">print</span>(<span class="kw">tail</span>(<span class="kw">select</span>(<span class="kw">filter</span>(cryptodata, symbol <span class="op">==</span><span class="st"> &#39;BTC&#39;</span>), </span>
<span id="cb37-2"><a href="data-prep.html#cb37-2"></a>                  ts_index, price_usd, lagged_price_24h, </span>
<span id="cb37-3"><a href="data-prep.html#cb37-3"></a>                  target_price_24h),<span class="dv">30</span>), <span class="dt">n=</span><span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 30 x 5
## # Groups:   symbol [1]
##    symbol ts_index            price_usd lagged_price_24h target_price_24h
##    &lt;chr&gt;  &lt;dttm&gt;                  &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 BTC    2021-04-29 09:00:00    53947.           54078.           54532.
##  2 BTC    2021-04-29 10:00:00    54553.           54222.           54333.
##  3 BTC    2021-04-29 11:00:00    54438.           54429.           54175.
##  4 BTC    2021-04-29 12:00:00    54298.           54843.           54220 
##  5 BTC    2021-04-29 13:00:00    54330.           55195.           54665.
##  6 BTC    2021-04-29 14:00:00    53589.           54775.           56010 
##  7 BTC    2021-04-29 15:00:00    53677.           54472.              NA 
##  8 BTC    2021-04-29 16:00:00    53695.           54318.              NA 
##  9 BTC    2021-04-29 17:00:00    52967.           54688.              NA 
## 10 BTC    2021-04-29 18:00:00    52746.           54846.              NA 
## 11 BTC    2021-04-29 19:00:00    52930.           54925.              NA 
## 12 BTC    2021-04-29 20:00:00    52870            55393.              NA 
## 13 BTC    2021-04-29 21:00:00    52980            54383.              NA 
## 14 BTC    2021-04-29 22:00:00    53332.           54792.              NA 
## 15 BTC    2021-04-29 23:00:00    53398.           54460.              NA 
## 16 BTC    2021-04-30 00:00:00    53560.           54833.              NA 
## 17 BTC    2021-04-30 01:00:00    53378.           54719.              NA 
## 18 BTC    2021-04-30 02:00:00    53385.           54575.              NA 
## 19 BTC    2021-04-30 03:00:00    53538.           54583.              NA 
## 20 BTC    2021-04-30 04:00:00    53699.           54276.              NA 
## 21 BTC    2021-04-30 05:00:00    54145.           53570.              NA 
## 22 BTC    2021-04-30 06:00:00    54280            53909.              NA 
## 23 BTC    2021-04-30 07:00:00    54420.           54368.              NA 
## 24 BTC    2021-04-30 08:00:00    54337.           54459.              NA 
## 25 BTC    2021-04-30 09:00:00    54532.           53947.              NA 
## 26 BTC    2021-04-30 10:00:00    54333.           54553.              NA 
## 27 BTC    2021-04-30 11:00:00    54175.           54438.              NA 
## 28 BTC    2021-04-30 12:00:00    54220            54298.              NA 
## 29 BTC    2021-04-30 13:00:00    54665.           54330.              NA 
## 30 BTC    2021-04-30 14:00:00    56010            53589.              NA</code></pre>
<p>Reading the code shown above is less than ideal. One of the more popular tools introduced by the <a href="https://www.tidyverse.org/">tidyverse</a> is the <span style="color: purple;"><strong>%&gt;%</strong></span> operator, which works by starting with the object/data you want to make changes to first, and then apply each transformation step by step. It’s simply a way of re-writing the same code in a way that is easier to read by splitting the way the function is called rather than adding functions onto each other into a single line that becomes really hard to read. In the example above it becomes difficult to keep track of where things begin, the order of operations, and the parameters associated with the specific functions. Compare that to the code below:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-prep.html#cb39-1"></a><span class="co"># Start with the object/data to manipulate</span></span>
<span id="cb39-2"><a href="data-prep.html#cb39-2"></a>cryptodata <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-3"><a href="data-prep.html#cb39-3"></a><span class="st">  </span><span class="co"># Filter the data to only the BTC symbol</span></span>
<span id="cb39-4"><a href="data-prep.html#cb39-4"></a><span class="st">  </span><span class="kw">filter</span>(symbol <span class="op">==</span><span class="st"> &#39;BTC&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-5"><a href="data-prep.html#cb39-5"></a><span class="st">  </span><span class="co"># Select columns to display</span></span>
<span id="cb39-6"><a href="data-prep.html#cb39-6"></a><span class="st">  </span><span class="kw">select</span>(ts_index, price_usd, lagged_price_24h, target_price_24h) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-7"><a href="data-prep.html#cb39-7"></a><span class="st">  </span><span class="co"># Show the last 30 elements of the data</span></span>
<span id="cb39-8"><a href="data-prep.html#cb39-8"></a><span class="st">  </span><span class="kw">tail</span>(<span class="dv">30</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-9"><a href="data-prep.html#cb39-9"></a><span class="st">  </span><span class="co"># Show all 30 elements instead of the default 10 for a tibble dataframe</span></span>
<span id="cb39-10"><a href="data-prep.html#cb39-10"></a><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>## # A tibble: 30 x 5
## # Groups:   symbol [1]
##    symbol ts_index            price_usd lagged_price_24h target_price_24h
##    &lt;chr&gt;  &lt;dttm&gt;                  &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 BTC    2021-04-29 09:00:00    53947.           54078.           54532.
##  2 BTC    2021-04-29 10:00:00    54553.           54222.           54333.
##  3 BTC    2021-04-29 11:00:00    54438.           54429.           54175.
##  4 BTC    2021-04-29 12:00:00    54298.           54843.           54220 
##  5 BTC    2021-04-29 13:00:00    54330.           55195.           54665.
##  6 BTC    2021-04-29 14:00:00    53589.           54775.           56010 
##  7 BTC    2021-04-29 15:00:00    53677.           54472.              NA 
##  8 BTC    2021-04-29 16:00:00    53695.           54318.              NA 
##  9 BTC    2021-04-29 17:00:00    52967.           54688.              NA 
## 10 BTC    2021-04-29 18:00:00    52746.           54846.              NA 
## 11 BTC    2021-04-29 19:00:00    52930.           54925.              NA 
## 12 BTC    2021-04-29 20:00:00    52870            55393.              NA 
## 13 BTC    2021-04-29 21:00:00    52980            54383.              NA 
## 14 BTC    2021-04-29 22:00:00    53332.           54792.              NA 
## 15 BTC    2021-04-29 23:00:00    53398.           54460.              NA 
## 16 BTC    2021-04-30 00:00:00    53560.           54833.              NA 
## 17 BTC    2021-04-30 01:00:00    53378.           54719.              NA 
## 18 BTC    2021-04-30 02:00:00    53385.           54575.              NA 
## 19 BTC    2021-04-30 03:00:00    53538.           54583.              NA 
## 20 BTC    2021-04-30 04:00:00    53699.           54276.              NA 
## 21 BTC    2021-04-30 05:00:00    54145.           53570.              NA 
## 22 BTC    2021-04-30 06:00:00    54280            53909.              NA 
## 23 BTC    2021-04-30 07:00:00    54420.           54368.              NA 
## 24 BTC    2021-04-30 08:00:00    54337.           54459.              NA 
## 25 BTC    2021-04-30 09:00:00    54532.           53947.              NA 
## 26 BTC    2021-04-30 10:00:00    54333.           54553.              NA 
## 27 BTC    2021-04-30 11:00:00    54175.           54438.              NA 
## 28 BTC    2021-04-30 12:00:00    54220            54298.              NA 
## 29 BTC    2021-04-30 13:00:00    54665.           54330.              NA 
## 30 BTC    2021-04-30 14:00:00    56010            53589.              NA</code></pre>
<p>There are several advantages to writing code <em>the</em> <strong><em>tidy</em></strong> <em>way</em>, but while some love it others hate it, so we won’t force anyone to have to understand how the <strong>%&gt;%</strong> operator works and we have stayed away from its use for the rest of the code shown, but we do encourage the use of this tool: <a href="https://magrittr.tidyverse.org/reference/pipe.html" class="uri">https://magrittr.tidyverse.org/reference/pipe.html</a></p>
</div>
</div>
<div id="remove-nulls-again" class="section level2">
<h2><span class="header-section-number">4.5</span> Remove Nulls</h2>
<p>We can’t do anything with a row of data if we don’t know <strong><em>when</em></strong> the data was collected, so let’s just double confirm that all rows have a value for the <span style="color: blue;"><strong>date_time_utc</strong></span> field by using the <span style="color: green;"><strong>filter()</strong></span> function from the <span style="color: #ae7b11;"><strong>dplyr</strong></span> package to exclude any rows with NA values for the column:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-prep.html#cb41-1"></a><span class="co"># Remove all NA values of date_time_utc:</span></span>
<span id="cb41-2"><a href="data-prep.html#cb41-2"></a>cryptodata &lt;-<span class="st"> </span><span class="kw">filter</span>(cryptodata, <span class="op">!</span><span class="kw">is.na</span>(date_time_utc))</span></code></pre></div>
<!-- Uncomment code below if visualization section runs into issues on ggforce step circling low and high point correctly -->
<!-- And now the same thing for the [**price_usd**]{style="color: blue;"} column: -->
<!-- ```{r omit_nulls_price_usd_final} -->
<!-- cryptodata <- filter(cryptodata, !is.na(price_usd)) -->
<!-- ``` -->
<p>This step removed 25629 rows from the data. This step mainly helps us avoid issues when programmatically labeling charts in the next section, move on to the <a href="visualization.html#visualization">next section</a> ➡️ to learn some amazingly powerful tools to visualize data!</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-anytime">
<p>Eddelbuettel, Dirk. 2020. <em>Anytime: Anything to Posixct or Date Converter</em>. <a href="http://dirk.eddelbuettel.com/code/anytime.html">http://dirk.eddelbuettel.com/code/anytime.html</a>.</p>
</div>
<div id="ref-R-tsibble">
<p>Wang, Earo, Di Cook, Rob Hyndman, and Mitchell O’Hara-Wild. 2020. <em>Tsibble: Tidy Temporal Data Frames and Tools</em>. <a href="https://tsibble.tidyverts.org">https://tsibble.tidyverts.org</a>.</p>
</div>
<div id="ref-R-dplyr">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2020. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="explore-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ries9112/cryptocurrencyresearch-org/blob/master/03-DataPrep.Rmd",
"text": "View Code on GitHub"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
